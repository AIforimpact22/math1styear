{# templates/sediment.html  (bilingual EN/HU) #}
{% extends "index.html" %}
{% block page_title %}{{ tr.page_title }}{% endblock %}

{% block controls %}
<div class="controls" aria-label="Page shortcuts">
  <a class="btn" href="/function-examples">{{ tr.nav_examples }}</a>
  <a class="btn" href="/relations">{{ tr.nav_relations }}</a>
</div>
{% endblock %}

{% block content %}
<section class="canvas-card" aria-label="Sediment transport plot">
  <div class="geo-plot">
    <figure>
      <img
        src="{{ url_for('sediment.plot_png', k=k, n=n, vmax=vmax, v=vpoint, lang=lang, cb=ts) }}"
        alt="{{ tr.fig_alt }}"
      >
      <figcaption>{{ figcaption_line|safe }}</figcaption>
    </figure>
  </div>
</section>

<aside>
  <style>
    .geo-plot{ padding:16px; }
    .geo-plot figure{ margin:0; }
    .geo-plot img{ width:100%; height:auto; display:block; border-radius:12px; border:1px solid #233040; background:#0f141c; }
    .geo-plot figcaption{ margin-top:8px; font-size:13px; color:#a9b8cc; }

    .geo-panel{ display:grid; gap:12px; }
    .geo-panel section{ background:#0f141c; border:1px solid #233040; border-radius:12px; padding:12px; }
    .geo-panel h2{ margin:0 0 8px; font-size:14px; color:#cbd7ea; }

    .geo-form{ display:grid; gap:10px; }
    .geo-form label{ display:flex; flex-direction:column; gap:4px; font-size:13px; color:#cbd7ea; }
    .geo-form input{
      background:#0d1320;
      border:1px solid #263243;
      color:#e8f0ff;
      border-radius:8px;
      padding:8px 10px;
    }
    .geo-form button{ align-self:start; }

    .geo-result{
      display:grid;
      gap:6px;
      background:#0d1320;
      border:1px solid #263243;
      border-radius:10px;
      padding:10px;
      color:#d7e6ff;
    }
    .geo-result strong{ color:#fef9c3; }

    .geo-note{ font-size:12px; color:#9fb2c7; line-height:1.5; }

    .lang-toggle { display:flex; gap:.5rem; align-items:center; margin-bottom:1rem; }
    .lang-toggle .btn { padding:.45rem .7rem; border-radius:8px; border:1px solid #233040; background:#0f141c; color:#cbd7ea; cursor:pointer; }
    .lang-toggle .btn.active { background:#1b2636; font-weight:700; }
    .lang-toggle label { color:#9fb2c7; font-size:14px; margin-right:.25rem; }
  </style>

  <div class="geo-panel">
    <!-- Language toggle (preserves current inputs) -->
    <div class="lang-toggle">
      <label>{{ tr.lang_label }}:</label>
      <form method="get" style="display:inline;">
        <input type="hidden" name="k" value="{{ k }}">
        <input type="hidden" name="n" value="{{ n }}">
        <input type="hidden" name="vmax" value="{{ vmax }}">
        <input type="hidden" name="v" value="{{ vpoint }}">
        <input type="hidden" name="Q" value="{{ Qtarget }}">
        <button class="btn {% if lang == 'en' %}active{% endif %}" type="submit" name="lang" value="en">{{ tr.lang_en }}</button>
        <button class="btn {% if lang == 'hu' %}active{% endif %}" type="submit" name="lang" value="hu">{{ tr.lang_hu }}</button>
      </form>
    </div>

    <section>
      <h2>{{ tr.about_h2 }}</h2>
      <p>{{ tr.about_p1 }} <strong>Qₛ = k · vⁿ</strong>, {{ tr.where }}</p>
      <ul>
        <li><strong>Qₛ</strong> — {{ tr.bul_Qs }}</li>
        <li><strong>k</strong> — {{ tr.bul_k }}</li>
        <li><strong>v</strong> — {{ tr.bul_v }}</li>
        <li><strong>n</strong> — {{ tr.bul_n }}</li>
      </ul>
      <p class="muted">{{ tr.math_notes }}</p>
      <hr>

      <h2>{{ tr.inputs_h2 }}</h2>
      <form class="geo-form" method="get">
        <!-- Preserve language on submit -->
        <input type="hidden" name="lang" value="{{ lang }}">
        <label>{{ tr.label_k }}
          <input type="number" step="any" name="k" value="{{ k }}">
        </label>
        <label>{{ tr.label_n }}
          <input type="number" step="any" name="n" value="{{ n }}">
        </label>
        <label>{{ tr.label_vmax|safe }}
          <input type="number" step="any" min="0" name="vmax" value="{{ vmax }}">
        </label>
        <label>{{ tr.label_v }}
          <input type="number" step="any" min="0" name="v" value="{{ vpoint }}">
        </label>
        <label>{{ tr.label_Q }}
          <input type="number" step="any" name="Q" value="{{ Qtarget }}">
        </label>
        <button type="submit" class="btn">{{ tr.btn_update }}</button>
      </form>
    </section>

    <section>
      <h2>{{ tr.calc_h2 }}</h2>
      <div class="geo-result">
        <div>
          <strong>{{ tr.forward_strong }}</strong>
          {{ forward_line }}
        </div>
        <div>
          <strong>{{ tr.inverse_strong }}</strong>
          {% if inverse_line %}
            {{ inverse_line }}
          {% else %}
            {{ inv_error }}
          {% endif %}
        </div>
      </div>
      <p class="geo-note">{{ tip_line }}</p>
    </section>
  </div>
</aside>

<section class="explain-card" aria-label="How to interpret the sediment transport function">
  <div class="explain-head">
    <span class="badge">Classroom tip</span>
    <code>Qₛ = k · vⁿ</code>
  </div>
  <div class="explain-body">
    {% if lang == 'hu' %}
      Ez a hatványfüggvény azt fejezi ki, hogy a kis sebességnövekedés is jelentős szállítás‑növekedést okozhat,
      ha <em>n</em> 2 és 5 közé esik. Minden <em>v</em> sebességhez egyetlen <em>Qₛ</em> érték tartozik (függvény),
      ezért a „függőleges egyenes próba” sikeres. Az <strong>k</strong> (anyag/geometria) és <strong>n</strong>
      (nemlinearitás) állításával különböző medrek csatornák hasonlíthatók össze.
    {% else %}
      This power‑law captures that small increases in flow velocity can cause large increases in transport
      when <em>n</em> is between 2 and 5. Each velocity <em>v</em> maps to a single transport value <em>Qₛ</em>,
      so it passes the vertical‑line test. Compare rivers/channels by adjusting <strong>k</strong> (material/geometry)
      and <strong>n</strong> (nonlinearity).
    {% endif %}
  </div>
</section>
{% endblock %}
