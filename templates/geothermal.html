{% extends "base.html" %}
{% set title = "Geothermal Gradient — Linear Model" %}
{% set h1 = "Geothermal Gradient: T(z) = T₀ + G·z" %}
{% set subtitle = "Depth on Y (0 at top, increasing downward) • Temperature on X (left→right)" %}

{% block content %}

<div class="grid grid-2">
  <section class="card">
    <h2>About the model</h2>
    <p>
      This classroom model assumes temperature increases approximately
      <em>linearly</em> with depth:
      <strong>T(z) = T₀ + G·z</strong>, where:
    </p>
    <ul>
      <li><strong>T₀</strong> is the surface temperature (°C),</li>
      <li><strong>G</strong> is the geothermal gradient (°C per kilometer),</li>
      <li><strong>z</strong> is depth (kilometers, positive downward).</li>
    </ul>

    <p class="muted">
      Plot convention used here: <strong>Depth</strong> is on the <strong>y‑axis</strong>
      with 0 at the top and increases downward; <strong>Temperature</strong> is on the
      <strong>x‑axis</strong> increasing to the right.
    </p>

    <p class="muted">
      Math notes: This is a linear function with slope <strong>G</strong> (°C per km) and intercept <strong>T₀</strong>.
      The inverse (when G ≠ 0) is <strong>z = (T − T₀) / G</strong>.
    </p>

    <hr>

    <form method="get">
      <div class="row">
        <label>Surface temperature T₀ (°C)
          <input type="number" step="any" name="T0" value="{{ T0 }}">
        </label>
        <label>Gradient G (°C/km)
          <input type="number" step="any" name="G" value="{{ G }}">
        </label>
        <label>Plot depth range z<sub>max</sub> (km)
          <input type="number" step="any" min="0" name="zmax" value="{{ zmax }}">
        </label>
        <label>Evaluate at depth z (km)
          <input type="number" step="any" min="0" name="z" value="{{ zpoint }}">
        </label>
        <label>Inverse: target temperature T (°C)
          <input type="number" step="any" name="T" value="{{ Ttarget }}">
        </label>
      </div>
      <p style="margin-top: .75rem;">
        <button type="submit">Update graph &amp; values</button>
      </p>
    </form>

    <div class="grid" style="margin-top: .75rem;">
      <div class="card" style="background:#fafafa;">
        <strong>Forward (T at depth):</strong>
        <p>
          At depth <strong>z = {{ zpoint|round(3) }} km</strong>,
          <strong>T = {{ T_at_z|round(3) }} °C</strong>.
        </p>
      </div>

      <div class="card" style="background:#fafafa;">
        <strong>Inverse (depth for a temperature):</strong>
        {% if z_for_T is not none %}
          <p>
            For <strong>T = {{ Ttarget|round(3) }} °C</strong>,
            the depth is
            <strong>z = {{ z_for_T|round(3) }} km</strong>.
          </p>
        {% else %}
          <p>Cannot compute inverse when G = 0 (no change with depth).</p>
        {% endif %}
      </div>
    </div>
  </section>

  <section class="card">
    <figure>
      <img
        src="{{ url_for('geothermal.plot_png', T0=T0, G=G, zmax=zmax, v=ts) }}"
        alt="Temperature (x) vs Depth (y, 0 at top) for T(z) = T0 + G·z"
        style="width:100%; height:auto; display:block; border-radius:8px;"
      >
      <figcaption>
        Temperature on x‑axis; depth on y‑axis (0 at the top, increasing downward).
        Plot shown for 0 ≤ z ≤ {{ zmax|round(3) }} km.
      </figcaption>
    </figure>
    <p class="muted" style="margin-top:.5rem;">
      Tip: A larger <strong>G</strong> shifts the line further to the right with depth (stronger heating per km).
    </p>
  </section>
</div>

{% endblock %}
